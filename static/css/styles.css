/* --- CSS Reset and Variables --- */
:root {
    /* Light Mode Colors */
    --bg-color-light: #fafafa;
    --text-color-light: #2c3e50;
    --primary-color-light: #f5f6fa;
    --secondary-color-light: #eef2f7;
    --accent-color-light: #3498db;
    --user-bubble-light: #e3f2fd;
    --ai-bubble-light: #ffffff;
    --sidebar-bg-light: #f5f5f5;
    /* Corrected typo here */
    --sidebar-border-light: #dddddd;
    --input-bg-light: #ffffff;
    --input-border-light: #cccccc;
    --hover-light: rgba(0, 0, 0, 0.05);
    --mic-recording-light: #dc3545; /* Red for recording */

    /* Dark Mode Colors */
    --bg-color-dark: #1e1e1e;
    --text-color-dark: #f1f1f1;
    --primary-color-dark: #2d2d2d;
    --secondary-color-dark: #3c3c3c;
    --accent-color-dark: #4dabf7; /* Changed to a complementary blue */
    --user-bubble-dark: #3a5373;
    --ai-bubble-dark: #333333;
    --sidebar-bg-dark: #252525;
    --sidebar-border-dark: #3a3a3a;
    --input-bg-dark: #2d2d2d;
    --input-border-dark: #444444;
    --hover-dark: rgba(255, 255, 255, 0.1);
    --mic-recording-dark: #e74c3c; /* Slightly brighter red for dark mode */

    /* New variables for new features */
    --timestamp-color: #888; /* Color for message timestamps */
    --error-bg-light: #f8d7da; /* Light error bubble background */
    --error-text-light: #721c24; /* Light error bubble text */
    --error-bg-dark: #721c24; /* Dark error bubble background */
    --error-text-dark: #f8d7da; /* Dark error bubble text */
    --like-color: #28a745; /* Green for like */
    --dislike-color: #dc3545; /* Red for dislike */
    --loading-spinner-color-light: #3498db;
    --loading-spinner-color-dark: #4dabf7;


    /* Common Variables */
    --border-radius: 12px;
    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --font-family: 'Cairo', 'Tahoma', sans-serif;
    --transition-speed: 0.3s;
    --sidebar-width: 280px; /* Define sidebar width as variable */
}

/* --- Global Styles --- */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: var(--font-family);
    margin: 0;
    padding: 0;
    background-color: var(--bg-color-light);
    color: var(--text-color-light);
    transition: background-color var(--transition-speed), color var(--transition-speed);
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    direction: rtl; /* Set RTL direction */
    text-align: right; /* Default text alignment for RTL */
}

body.dark-mode {
    background-color: var(--bg-color-dark);
    color: var(--text-color-dark);
}

/* --- App Container --- */
.app-container {
    display: flex;
    height: 100%; /* Use 100% to match body height */
    width: 100%;
    position: relative;
}

/* --- Sidebar Styles --- */
#settings-sidebar {
    width: var(--sidebar-width); /* Use variable */
    height: 100%;
    background-color: var(--sidebar-bg-light);
    border-left: 1px solid var(--sidebar-border-light);
    padding: var(--spacing-md);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    transition: background-color var(--transition-speed), border-color var(--transition-speed), transform var(--transition-speed);
    z-index: 10;
    flex-shrink: 0;
    /* Ensure correct positioning for RTL */
    right: 0;
    position: relative; /* Keep relative for desktop flow */
     /* Custom Scrollbar for Sidebar (can keep the simple one from original) */
     &::-webkit-scrollbar {
        width: 8px;
     }
     &::-webkit-scrollbar-track {
         background: var(--sidebar-bg-light);
     }
     &::-webkit-scrollbar-thumb {
         background: #888; /* Default scrollbar color */
         border-radius: 10px;
     }
     body.dark-mode &::-webkit-scrollbar-track {
         background: var(--sidebar-bg-dark);
     }
     body.dark-mode &::-webkit-scrollbar-thumb {
         background: #555;
     }
}

body.dark-mode #settings-sidebar {
    background-color: var(--sidebar-bg-dark);
    border-left-color: var(--sidebar-border-dark);
}

/* New: Sidebar Header to contain title and close button */
.sidebar-header {
    display: flex;
    justify-content: space-between; /* Space between title and button */
    align-items: center;
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-sm); /* Add padding below header */
    border-bottom: 1px solid var(--sidebar-border-light); /* Separator line */
}
body.dark-mode .sidebar-header {
    border-bottom-color: var(--sidebar-border-dark);
}


#settings-sidebar h2 {
    text-align: center; /* Can override or keep based on header flex */
    margin: 0; /* Remove default h2 margin if using flex header */
    color: var(--accent-color-light);
}

body.dark-mode #settings-sidebar h2 {
    color: var(--accent-color-dark);
}

#settings-sidebar h3 {
    margin-bottom: var(--spacing-sm);
    font-size: 1.1rem;
     /* Optional: Add border bottom like in newer CSS */
     border-bottom: 1px solid var(--sidebar-border-light);
     padding-bottom: var(--spacing-xs);
}
body.dark-mode #settings-sidebar h3 {
     border-bottom-color: var(--sidebar-border-dark);
}


.sidebar-section {
    margin-bottom: var(--spacing-lg);
}

.setting-item, .feature-item {
    margin-bottom: var(--spacing-md);
     /* Use flex to align label and control */
     display: flex;
     align-items: center;
     justify-content: space-between; /* Push items to edges */
     flex-wrap: wrap; /* Allow wrapping if needed */
}

.setting-item label {
    display: block; /* Can keep display block if not using flex extensively */
    margin-bottom: var(--spacing-xs); /* Margin below label */
    font-weight: 600;
    flex-grow: 1; /* Allow label to take space with flex */
    margin-left: var(--spacing-sm); /* Margin left for RTL spacing from control */
}
/* If label remains block, remove flex on setting-item */
/* If using flex, remove margin-bottom on label */
.setting-item label { margin-bottom: 0; } /* Adjusted for flex */


.feature-link {
    display: flex;
    align-items: center;
    /* Adjusted padding slightly */
    padding: var(--spacing-sm) var(--spacing-md);
    background-color: var(--secondary-color-light); /* Using secondary as background */
    color: var(--text-color-light);
    border-radius: var(--border-radius); /* Use variable */
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
    border: 1px solid var(--input-border-light); /* Keep border from original */
    width: 100%; /* Make it full width */
    justify-content: space-between; /* Space out text and icon in RTL */
}

body.dark-mode .feature-link {
    background-color: var(--secondary-color-dark);
    color: var(--text-color-dark);
    border-color: var(--input-border-dark);
}

.feature-link:hover {
    background-color: var(--hover-light); /* Use hover variable */
    /* transform: translateY(-2px); */ /* Optional: remove transform */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

body.dark-mode .feature-link:hover {
    background-color: var(--hover-dark);
}

.feature-link i {
    margin-left: 0; /* Remove old margin-left */
    margin-right: var(--spacing-sm); /* Add margin-right for icon in RTL */
    color: var(--accent-color-light);
}

body.dark-mode .feature-link i {
    color: var(--accent-color-dark);
}

.setting-item select,
.setting-item input[type="number"] {
    width: auto; /* Let it size based on content/min-width */
    min-width: 100px; /* Minimum width */
    padding: var(--spacing-sm);
    border-radius: var(--border-radius);
    border: 1px solid var(--input-border-light);
    background-color: var(--input-bg-light);
    color: var(--text-color-light);
    font-family: var(--font-family);
    transition: border-color var(--transition-speed), background-color var(--transition-speed), color var(--transition-speed);
    flex-shrink: 0; /* Prevent shrinking in flex */
}

body.dark-mode .setting-item select,
body.dark-mode .setting-item input[type="number"] {
    border-color: var(--input-border-dark);
    background-color: var(--input-bg-dark);
    color: var(--text-color-dark);
}

/* Slider styles */
.slider-container {
    display: flex;
    align-items: center;
     /* Add padding/border/background here instead of on input[type="range"] */
    padding: var(--spacing-sm);
    background-color: var(--input-bg-light);
    border: 1px solid var(--input-border-light);
    border-radius: var(--border-radius);
    flex-grow: 0; /* Prevent stretching */
    flex-shrink: 0;
    width: auto; /* Adjust width */
    min-width: 120px; /* Adjusted min-width */
}
body.dark-mode .slider-container {
     background-color: var(--input-bg-dark);
     border-color: var(--input-border-dark);
}


.slider-container input[type="range"] {
    flex-grow: 1;
    margin-left: 0; /* Remove old margin-left */
    margin-right: var(--spacing-sm); /* Space between slider and value in RTL */
     /* Remove padding, border, background from the input itself */
    padding: 0;
    border: none;
    background-color: transparent;
}

.slider-container span {
    min-width: 30px;
    text-align: center;
    font-size: 0.9rem; /* Slightly smaller font for value */
    color: var(--text-color-light); /* Use text color var */
}
body.dark-mode .slider-container span {
    color: var(--text-color-dark);
}


/* Toggle Switch */
.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
    flex-shrink: 0; /* Prevent shrinking */
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    right: 0;
    left: 0;
    bottom: 0;
    background-color: var(--secondary-color-light);
    transition: var(--transition-speed);
    border-radius: 24px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    right: 4px; /* Initial position in RTL */
    bottom: 4px;
    background-color: white;
    transition: var(--transition-speed);
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--accent-color-light);
}

body.dark-mode input:checked + .slider {
    background-color: var(--accent-color-dark);
}

input:checked + .slider:before {
    transform: translateX(-26px); /* Move to the left in RTL */
}

/* Conversations List */
.conversations-container {
    margin-top: var(--spacing-sm);
    max-height: 300px; /* Keep original max height */
    overflow-y: auto;
     /* Ensure scrollbar is visible */
     padding-left: var(--spacing-xs); /* Add padding to prevent content hiding under scrollbar */
}

.conversation-item {
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--border-radius);
    margin-bottom: var(--spacing-xs);
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color var(--transition-speed);
     /* Ensure flex-items handle space correctly in RTL */
     flex-direction: row-reverse; /* Reverse order to put actions on the left in RTL */
     /* Optional: Add border to prevent size jump on active */
     border: 1px solid transparent;
     position: relative; /* Needed for loading state spinner */
     overflow: hidden; /* Hide overflow of spinner */
}

.conversation-item:hover {
    background-color: var(--hover-light);
}

body.dark-mode .conversation-item:hover {
    background-color: var(--hover-dark);
}

.conversation-item.active {
    background-color: var(--accent-color-light);
    color: white;
}

body.dark-mode .conversation-item.active {
    background-color: var(--accent-color-dark);
}

/* New: Loading state for conversation item */
.conversation-item.loading {
    opacity: 0.7; /* Dim slightly */
    pointer-events: none; /* Prevent clicks */
}
.conversation-item.loading::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top: 3px solid white; /* Spinner color */
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    z-index: 1;
}
body.dark-mode .conversation-item.loading::after {
     border-top-color: var(--accent-color-dark);
     border-color: rgba(var(--accent-color-dark-rgb, 77, 171, 247), 0.3); /* Use RGB if available, fallback to rgba */
}


.conversation-actions {
    display: flex;
    gap: var(--spacing-xs);
    flex-shrink: 0; /* Prevent icons from pushing text */
     /* Adjust positioning for RTL */
     margin-left: 0; /* Remove old margin */
     margin-right: var(--spacing-sm); /* Space between text and actions */
     /* Optional: Hide actions until hover for cleaner look */
     opacity: 0;
     transition: opacity 0.15s ease;
     z-index: 1; /* Ensure actions are clickable */
}
/* Show actions on hover or if item is active */
.conversation-item:hover .conversation-actions,
.conversation-item.active .conversation-actions {
    opacity: 1;
}


.conversation-item span {
    flex-grow: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    /* margin-left: var(--spacing-sm); */ /* Removed old margin */
     /* Ensure text aligns correctly in RTL */
    text-align: right;
     /* Allow text to shrink without pushing actions out */
     min-width: 0;
}


.empty-state {
    text-align: center;
    color: #888;
    padding: var(--spacing-md);
    font-style: italic;
     /* New: Use flex for centering icon and text */
     display: flex;
     flex-direction: column;
     align-items: center;
}
/* New: Styling for icon in empty state */
.empty-state i {
    margin-bottom: var(--spacing-sm);
    font-size: 1.5rem;
    color: #bbb; /* Muted color */
}
/* New: Styling for loading state text/icon color */
.empty-state.loading-conversations i,
.empty-state.loading-messages i {
     color: var(--loading-spinner-color-light);
}
body.dark-mode .empty-state.loading-conversations i,
body.dark-mode .empty-state.loading-messages i {
     color: var(--loading-spinner-color-dark);
}
/* New: Styling for error state text/icon color */
.empty-state.error-state i {
     color: var(--error-color-light);
}
body.dark-mode .empty-state.error-state i {
     color: var(--error-color-dark);
}


/* Buttons */
.primary-button {
    width: 100%;
    padding: var(--spacing-md);
    background-color: var(--accent-color-light);
    color: white;
    border: none;
    border-radius: var(--border-radius);
    font-family: var(--font-family);
    font-weight: 600;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
    transition: background-color var(--transition-speed);
}

body.dark-mode .primary-button {
    background-color: var(--accent-color-dark);
}

.primary-button:hover {
    opacity: 0.9;
}

.primary-button:active {
    transform: scale(0.98);
}

.icon-button {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--text-color-light);
    padding: var(--spacing-xs);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color var(--transition-speed), color var(--transition-speed); /* Added color transition */
}

body.dark-mode .icon-button {
    color: var(--text-color-dark);
}

.icon-button:hover {
    background-color: var(--hover-light);
}

body.dark-mode .icon-button:hover {
    background-color: var(--hover-dark);
}
/* New: Disabled state for icon buttons */
.icon-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}


.danger-button {
    background-color: #dc3545;
    color: white;
    border: none;
    border-radius: var(--border-radius);
    padding: var(--spacing-sm) var(--spacing-md);
    cursor: pointer;
    font-family: var(--font-family);
    transition: background-color var(--transition-speed);
}

.danger-button:hover {
    background-color: #c82333;
}

/* Sidebar Footer */
.sidebar-footer {
    margin-top: auto;
    padding-top: var(--spacing-md);
     /* Optional: Add border top like in newer CSS */
    border-top: 1px solid var(--sidebar-border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #888;
    font-size: 0.9rem;
}
body.dark-mode .sidebar-footer {
    border-top-color: var(--sidebar-border-dark);
}


/* --- Chat Container --- */
#chat-container {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
    overflow: hidden; /* Prevent overflow issues with message bubbles */
}

/* --- Header and Footer Styles --- */
.chat-header,
.chat-footer {
    flex-shrink: 0; /* Prevent shrinking */
    padding: var(--spacing-sm) var(--spacing-lg); /* Padding top/bottom, left/right */
    text-align: center; /* Center text */
    background-color: var(--primary-color-light); /* Subtle background */
    color: var(--text-color-light);
    transition: background-color var(--transition-speed), color var(--transition-speed);
     /* New: Add z-index to ensure it's above messages */
    z-index: 5;
}

body.dark-mode .chat-header,
body.dark-mode .chat-footer {
    background-color: var(--primary-color-dark);
    color: var(--text-color-dark);
}

.chat-header {
    border-bottom: 1px solid var(--secondary-color-light); /* Separator */
}

body.dark-mode .chat-header {
    border-bottom-color: var(--secondary-color-dark);
}

.chat-header h2 {
    margin-bottom: var(--spacing-xs); /* Space below title */
    font-size: 1.1rem;
    color: inherit; /* Use parent color */
    display: inline-block; /* Allow version to be on same line */
    /* Adjust margin for RTL */
    margin-left: 0;
    margin-right: var(--spacing-sm); /* Space between title and version/author in RTL */
}

.chat-header .version {
     font-size: 0.8em; /* Make version slightly smaller than title */
     opacity: 0.8;
     /* Adjust margin for RTL */
     margin-left: 0;
     margin-right: var(--spacing-xs); /* Space after version in RTL */
}

.chat-header p,
.chat-footer p {
    font-size: 0.9rem;
    margin: 0; /* Remove default paragraph margin */
    color: #888; /* Muted color */
}

body.dark-mode .chat-header p,
body.dark-mode .chat-footer p {
    color: #bbb; /* Slightly lighter muted color */
}

.chat-footer {
    border-top: 1px solid var(--secondary-color-light); /* Separator */
    margin-top: auto; /* Push to the bottom if needed (though flex takes care of it) */
     /* New: Add z-index */
    z-index: 5;
}

body.dark-mode .chat-footer {
    border-top-color: var(--secondary-color-dark);
}

/* New: Overlay for mobile sidebar */
#sidebar-overlay {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.4); /* Semi-transparent dark overlay */
    z-index: 9; /* Below sidebar (z-index 10), above chat content */
    transition: opacity var(--transition-speed) ease;
    opacity: 0;
}
#sidebar-overlay.show {
    display: block;
    opacity: 1;
}


/* Offline Indicator */
#offline-indicator {
    display: none; /* Hidden by default, controlled by JS */
    position: absolute;
    top: calc(var(--chat-header-height) + var(--spacing-md)); /* Position below header */
    left: 50%;
    transform: translateX(-50%); /* Center horizontally */
    background-color: #ffc107; /* Warning color */
    color: #333;
    padding: var(--spacing-xs) var(--spacing-sm); /* Adjusted padding */
    border-radius: 15px;
    font-size: 0.9rem;
    z-index: 100; /* High z-index */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    opacity: 0;
    transition: opacity var(--transition-speed);
    pointer-events: none; /* Non-interactive */
     /* New: Flex for centering content */
     display: flex;
     align-items: center;
     gap: var(--spacing-xs);
     min-width: 150px; /* Ensure visibility */
     justify-content: center;
}

#offline-indicator.visible {
    display: flex; /* Use flex when visible */
    opacity: 1;
}

#offline-indicator i {
    /* Adjusted margin for RTL */
    margin-left: 0;
    margin-right: var(--spacing-xs);
}

/* New: Global App Error Message */
#app-error-message {
    position: fixed;
    /* Bottom position adjusted by JS based on input area/regenerate button */
    bottom: 20px; /* Default/fallback position */
    left: 50%;
    transform: translateX(-50%); /* Center horizontally */
    background-color: var(--error-color-light); /* Error color */
    color: white;
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--border-radius);
    font-size: 0.9rem;
    z-index: 110; /* Higher than offline indicator */
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    opacity: 0;
    visibility: hidden; /* Hide completely when not shown */
    transition: opacity 0.4s ease, bottom 0.4s ease; /* Smooth transition for showing/hiding and position changes */
    display: flex; /* Use flex for icon and text */
    align-items: center;
    gap: var(--spacing-xs);
    pointer-events: none; /* Non-interactive */
    max-width: 90%; /* Limit width */
    text-align: right; /* Ensure text alignment */
}
body.dark-mode #app-error-message {
    background-color: var(--error-color-dark);
}
#app-error-message.show {
    opacity: 1;
    visibility: visible;
    /* Bottom position is updated by JS */
}


/* Messages Container */
#messages {
    flex-grow: 1;
    overflow-y: auto;
    padding: var(--spacing-lg);
    background-color: var(--primary-color-light);
    transition: background-color var(--transition-speed);
    display: flex;
    flex-direction: column;
    /* New: Add gap between messages */
    gap: var(--spacing-md);
}

body.dark-mode #messages {
    background-color: var(--primary-color-dark);
}

/* Message Bubbles */
.message-bubble {
    max-width: 80%; /* Keep original width */
    padding: var(--spacing-md);
    border-radius: 15px;
    /* margin-bottom: var(--spacing-lg); */ /* Remove static margin-bottom to use gap */
    position: relative;
    line-height: 1.6;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    word-wrap: break-word;
    white-space: pre-wrap;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
     /* New: Add padding at the bottom to make space for timestamp and actions */
    padding-bottom: calc(var(--spacing-md) + 15px); /* Adjust based on desired space */
}
/* New: Add a bottom margin to the last bubble if using gap */
#messages > .message-bubble:last-child {
     margin-bottom: var(--spacing-lg); /* Add margin to the very last one */
}


.user-bubble {
    background-color: var(--user-bubble-light);
    color: #052c65;
    margin-left: auto; /* Push to the left in RTL */
    margin-right: 0; /* Ensure no default margin right */
    border-bottom-left-radius: 5px;
    text-align: right;
}

body.dark-mode .user-bubble {
    background-color: var(--user-bubble-dark);
    color: var(--text-color-dark);
}

.ai-bubble {
    background-color: var(--ai-bubble-light);
    color: var(--text-color-light);
    margin-right: auto; /* Push to the right in RTL */
    margin-left: 0; /* Ensure no default margin left */
    border-bottom-right-radius: 5px;
    text-align: right;
}

body.dark-mode .ai-bubble {
    background-color: var(--ai-bubble-dark);
    color: var(--text-color-dark);
}

/* New: Message Timestamp */
.message-timestamp {
    position: absolute;
    bottom: var(--spacing-xs); /* 4px from bottom */
    right: var(--spacing-md); /* 16px from right in RTL */
    font-size: 0.7rem; /* Smaller font size */
    color: var(--timestamp-color); /* Use timestamp color var */
    opacity: 0; /* Hidden by default, shown on hover */
    transition: opacity 0.15s ease;
    direction: ltr; /* Display time LTR */
}
body.dark-mode .message-timestamp {
    color: var(--timestamp-color); /* Same color for dark mode for consistency */
}
/* Position timestamp for user bubble (on the left) */
.user-bubble .message-timestamp {
    left: var(--spacing-md); /* 16px from left */
    right: auto; /* Disable right positioning */
}


/* Message Actions (Copy, Speak, Vote) */
.message-actions {
    position: absolute;
    bottom: var(--spacing-xs); /* 4px from bottom */
    left: var(--spacing-md); /* 16px from left in RTL (for AI bubbles) */
    display: flex;
    gap: var(--spacing-xs);
    opacity: 0.5; /* More subtle when not hovered (from original) */
    transition: opacity var(--transition-speed);
     z-index: 2; /* Ensure actions are clickable over timestamp */
}

.message-bubble:hover .message-actions {
    opacity: 1; /* Full visibility on hover */
}
/* New: Position actions for user bubble (on the right) */
.user-bubble .message-actions {
     right: var(--spacing-md); /* 16px from right */
     left: auto; /* Disable left positioning */
     justify-content: flex-end; /* Align actions to the right in RTL user bubble */
}


.message-actions button {
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: 50%;
    color: inherit; /* Inherit color from bubble text */
    opacity: 0.6; /* Less prominent (from original) */
    transition: opacity var(--transition-speed), background-color var(--transition-speed);
}

.message-actions button:hover {
    opacity: 1;
    background-color: rgba(0,0,0,0.05);
}

body.dark-mode .message-actions button:hover {
    background-color: rgba(255,255,255,0.1);
}
/* New: Styling for active speak button icon */
.message-actions button i.fa-volume-high {
    color: var(--accent-color-light); /* Use accent color for active state */
}
body.dark-mode .message-actions button i.fa-volume-high {
    color: var(--accent-color-dark);
}

/* New: Specific styles for Vote buttons container */
.vote-buttons {
    display: flex;
    gap: var(--spacing-xs); /* Space between like/dislike */
    align-items: center;
    margin-left: var(--spacing-sm); /* Space from copy/speak buttons */
    flex-shrink: 0; /* Prevent shrinking */
}
/* New: Styling for vote button icons */
.vote-buttons button {
     color: var(--timestamp-color); /* Default color is muted like timestamp */
     transition: color 0.15s ease, transform 0.1s ease;
     /* Remove default button padding/border/background */
     background: none;
     border: none;
     padding: var(--spacing-xs);
}
.vote-buttons button:hover {
     opacity: 1; /* Full opacity on hover */
     background-color: rgba(0,0,0,0.05); /* Subtle hover effect */
}
body.dark-mode .vote-buttons button:hover {
     background-color: rgba(255,255,255,0.1);
}
/* New: Active state colors for vote buttons */
.vote-buttons button.liked i {
    color: var(--like-color); /* Green */
}
.vote-buttons button.disliked i {
    color: var(--dislike-color); /* Red */
}
/* New: Disabled state after voting */
.vote-buttons button:disabled {
     opacity: 1; /* Keep color visible */
     cursor: default;
     pointer-events: none; /* Prevent further clicks */
     background: none; /* Remove hover background if disabled while hovered */
}
.vote-buttons button:disabled:hover {
     background: none; /* Ensure no hover effect when disabled */
}


/* New: Error Message Bubble */
.message-bubble.error-bubble {
    background-color: var(--error-bg-light); /* Light red */
    color: var(--error-text-light); /* Dark red text */
    border: 1px solid #f5c6cb;
    border-radius: var(--border-radius); /* Fully rounded corners */
    margin-right: auto; /* Center align in RTL */
    margin-left: auto;
    max-width: 95%; /* Wider than normal bubbles */
    padding: var(--spacing-md);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    text-align: right;
    /* Remove padding added for timestamp/actions as they are not on error bubbles */
    padding-bottom: var(--spacing-md);
}
body.dark-mode .message-bubble.error-bubble {
    background-color: var(--error-bg-dark);
    color: var(--error-text-dark);
    border-color: #f5c6cb; /* Can keep same border or change */
}
.message-bubble.error-bubble i {
    flex-shrink: 0; /* Prevent icon from shrinking */
    font-size: 1.2rem;
}


/* Typing Indicator */
.typing-indicator-bubble {
     /* Base styles similar to AI bubble */
    max-width: 80%; /* Match AI bubble width */
    margin-right: auto; /* Match AI bubble alignment */
    margin-left: 0;
    padding: var(--spacing-md);
    border-radius: 15px;
    border-bottom-right-radius: 5px;
    background-color: var(--ai-bubble-light);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    /* Remove padding added for timestamp/actions */
    padding-bottom: var(--spacing-md);
     /* New: Use flex for the indicator dots */
    display: flex;
    align-items: center;
    justify-content: flex-end; /* Align dots to the right in RTL bubble */
    direction: ltr; /* Ensure dots animate left-to-right */
}
body.dark-mode .typing-indicator-bubble {
     background-color: var(--ai-bubble-dark);
}

.typing-indicator {
    /* flex container already on typing-indicator-bubble */
    display: flex; /* Redundant but safe */
    align-items: center; /* Redundant but safe */
    margin-right: var(--spacing-md); /* Space before typing dots */
}

.typing-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #888;
    margin-left: 3px;
    animation: typingAnimation 1.4s infinite;
}

.typing-dot:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typingAnimation {
    0% { opacity: 0.3; transform: translateY(0); }
    50% { opacity: 1; transform: translateY(-5px); }
    100% { opacity: 0.3; transform: translateY(0); }
}

/* New: Regenerate Button */
#regenerate-button {
    display: flex; /* Controlled by JS */
    align-items: center;
    justify-content: center;
    gap: var(--spacing-xs);
    margin: var(--spacing-md) auto; /* Center horizontally, add margin above and below */
    padding: var(--spacing-sm) var(--spacing-md);
    background-color: var(--secondary-color-light);
    color: var(--text-color-light);
    border: none; /* Keep original border: none */
    border-radius: var(--border-radius);
    font-family: var(--font-family);
    font-size: 0.9rem;
    cursor: pointer;
    transition: background-color var(--transition-speed), transform var(--transition-speed);
    flex-shrink: 0; /* Prevent shrinking */
}
body.dark-mode #regenerate-button {
    background-color: var(--secondary-color-dark);
    color: var(--text-color-dark);
}
#regenerate-button:hover {
    background-color: var(--accent-color-light); /* Change color on hover */
    color: white;
}
body.dark-mode #regenerate-button:hover {
    background-color: var(--accent-color-dark);
}
#regenerate-button:active {
    transform: scale(0.98);
}


/* Input Area */
#input-area {
    padding: var(--spacing-md);
    background-color: var(--bg-color-light);
    border-top: 1px solid var(--secondary-color-light);
    transition: background-color var(--transition-speed), border-color var(--transition-speed);
    flex-shrink: 0; /* Prevent shrinking */
}

body.dark-mode #input-area {
    background-color: var(--bg-color-dark);
    border-top-color: var(--secondary-color-dark);
}

#input-container {
    display: flex;
    align-items: center;
    background-color: var(--input-bg-light);
    border: 1px solid var(--input-border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-xs) var(--spacing-sm);
    transition: background-color var(--transition-speed), border-color var(--transition-speed);
}

body.dark-mode #input-container {
    background-color: var(--input-bg-dark);
    border-color: var(--input-border-dark);
}

#message-input {
    flex-grow: 1;
    border: none;
    outline: none;
    padding: var(--spacing-sm);
    background-color: transparent;
    color: var(--text-color-light);
    font-family: var(--font-family);
    resize: none;
    min-height: 40px;
    max-height: 200px;
    transition: color var(--transition-speed);
     /* Ensure correct text alignment and direction */
    text-align: right;
    direction: rtl;
}

body.dark-mode #message-input {
    color: var(--text-color-dark);
}

#message-input::placeholder {
    color: #999;
}

body.dark-mode #message-input::placeholder {
    color: #777;
}

#send-button {
    border: none;
    background-color: var(--accent-color-light);
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    /* Adjust margin for RTL */
    margin-right: 0;
    margin-left: var(--spacing-xs);
    transition: background-color var(--transition-speed), transform var(--transition-speed);
    flex-shrink: 0; /* Prevent shrinking */
}

body.dark-mode #send-button {
    background-color: var(--accent-color-dark);
}

#send-button:hover {
    opacity: 0.9;
}

#send-button:active {
    transform: scale(0.95);
}

#send-button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
     /* Optional: match dark mode disabled color */
     body.dark-mode & {
         background-color: #555;
     }
}


/* Input Footer */
.input-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: var(--spacing-xs);
    padding: 0 var(--spacing-xs);
     /* Ensure text alignment in footer */
    text-align: right;
}

.typing-hint {
    font-size: 0.8rem;
    color: #888;
}

body.dark-mode .typing-hint {
    color: #777;
}

/* Mobile Menu (Button to open sidebar on mobile) */
#mobile-menu {
    display: none; /* Hidden by default */
    position: fixed;
    top: 10px;
    right: 10px; /* Position on the right in RTL */
    width: 40px;
    height: 40px;
    background-color: var(--accent-color-light);
    color: white;
    border-radius: 50%;
    z-index: 15; /* Above chat, below open sidebar */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: background-color var(--transition-speed);
     /* Use flex to center content */
    display: flex;
    align-items: center;
    justify-content: center;
    border: none; /* Remove default button border */
}

body.dark-mode #mobile-menu {
    background-color: var(--accent-color-dark);
}

/* Mobile Settings Button (Button in input footer to open sidebar) */
#mobile-settings {
    display: none; /* Hidden by default, shown in media query */
}
/* New: Close button inside sidebar header (mobile only) */
#close-sidebar {
    /* Display handled by media query and JS */
    /* Styling already defined above with icon-button */
}


/* Microphone Button Styles */
#mic-button {
    /* Adjust margin for RTL */
    margin-right: 0;
    margin-left: var(--spacing-xs);
    transition: color var(--transition-speed), background-color var(--transition-speed);
     flex-shrink: 0; /* Prevent shrinking */
}

#mic-button.recording {
    color: var(--mic-recording-light);
    animation: pulse 1.5s infinite;
}

body.dark-mode #mic-button.recording {
    color: var(--mic-recording-dark);
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

/* Confirmation Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0,0,0,0.5);
    z-index: 100;
    justify-content: center;
    align-items: center;
     /* New: Add opacity transition */
    opacity: 0;
    transition: opacity var(--transition-speed) ease;
}

.modal.show {
    display: flex;
    opacity: 1;
}

.modal-content {
    background-color: var(--bg-color-light);
    padding: var(--spacing-lg);
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 400px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    transition: background-color var(--transition-speed);
     /* Ensure text alignment in modal */
    text-align: right;
}

body.dark-mode .modal-content {
    background-color: var(--bg-color-dark);
}

.modal-content h3 {
    margin-bottom: var(--spacing-md);
    text-align: center;
}

.modal-buttons {
    display: flex;
    justify-content: flex-end; /* Buttons to the right in RTL */
    gap: var(--spacing-md);
    margin-top: var(--spacing-lg);
}

.modal-buttons button {
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--border-radius);
    cursor: pointer;
    font-family: var(--font-family);
     /* Optional: Add transition for hover/active */
    transition: background-color 0.15s ease, opacity 0.15s ease;
}

.modal-buttons button:not(.danger-button) {
    background-color: var(--secondary-color-light);
    border: none;
    color: var(--text-color-light);
    /* transition: background-color var(--transition-speed), color var(--transition-speed); */ /* Already in general button style */
}

body.dark-mode .modal-buttons button:not(.danger-button) {
    background-color: var(--secondary-color-dark);
    color: var(--text-color-dark);
}
/* Optional: Hover effect for non-danger button */
.modal-buttons button:not(.danger-button):hover {
    opacity: 0.9;
}


/* Responsive Design */
@media (max-width: 768px) {
    .app-container {
        flex-direction: column;
    }

    #settings-sidebar {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        width: 80%; /* Take 80% of the screen width */
        max-width: 320px;
        transform: translateX(100%); /* Start off-screen */
        z-index: 20;
        box-shadow: -2px 0 10px rgba(0,0,0,0.2);
    }

    #settings-sidebar.show {
        transform: translateX(0); /* Slide in */
    }

    #mobile-menu {
        display: flex; /* Show on mobile */
         /* Adjust position so it's not covered by the sidebar when open */
         /* Handled by JS adding a class or recalculating in resize listener */
    }
     /* New: Style for mobile menu button when sidebar is open */
     #settings-sidebar.show + #sidebar-overlay + #chat-container #mobile-menu {
         right: calc(var(--sidebar-width) + var(--spacing-md)); /* Move button outside sidebar */
         transition: right var(--transition-speed) ease-in-out; /* Animate movement */
     }


    #mobile-settings {
        display: block; /* Show on mobile */
    }

    .sidebar-footer #toggle-sidebar {
        display: none; /* Hide on mobile */
    }

     /* New: Show close button in sidebar header on mobile */
     #settings-sidebar .sidebar-header #close-sidebar {
         display: flex;
     }


    /* Slightly smaller messages on mobile */
    .message-bubble {
        max-width: 90%;
    }
     /* New: Adjust position of actions/timestamp on mobile */
     /* Since timestamp is hidden on mobile, actions can move up */
     .message-actions {
         bottom: var(--spacing-sm); /* Move up */
         left: var(--spacing-sm); /* Adjust left margin */
         right: auto; /* Ensure right is auto */
          /* Optional: Make actions always visible on mobile? */
         /* opacity: 1; */ /* Uncomment this line to make actions always visible on mobile */
     }
    .user-bubble .message-actions {
         right: var(--spacing-sm); /* Adjust right margin */
         left: auto; /* Ensure left is auto */
     }
     /* New: Hide timestamp on mobile */
     .message-timestamp {
         display: none;
     }
     /* New: Reduce bottom padding on bubble since timestamp is hidden */
     .message-bubble {
         padding-bottom: var(--spacing-md);
     }


    /* Adjust input area padding on mobile */
    #input-area {
        padding: var(--spacing-sm);
    }
    #input-container {
         padding: var(--spacing-xs);
    }
    #message-input {
         padding: var(--spacing-sm);
    }
     /* Adjust margins for buttons in input container */
     #mic-button, #send-button {
         margin-left: var(--spacing-xs); /* Keep small margin */
     }

    /* Adjust footer padding on mobile */
    .input-footer {
        padding: 0 var(--spacing-xs);
    }

    /* Adjust header/footer padding on mobile */
    .chat-header, .chat-footer {
        padding: var(--spacing-sm) var(--spacing-md);
    }
}

/* Utilities */
.hidden {
    display: none !important;
}

.fade-in {
    animation: fadeIn 0.3s;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Special Loading Effect for Chat Bubble (Keep original) */
.loading-content {
    display: inline-block;
    min-width: 1em;
    min-height: 1em;
}

/* Print Styles (Keep original) */
@media print {
    #settings-sidebar, #input-area, #mobile-menu, .chat-header, .chat-footer, .message-actions, #offline-indicator, #app-error-message, #sidebar-overlay, .message-timestamp {
        display: none !important;
    }

    body, #chat-container, #messages {
        height: auto !important;
        overflow: visible !important;
    }

    .message-bubble {
        break-inside: avoid;
        page-break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ddd;
         padding-bottom: var(--spacing-md); /* Ensure padding is suitable for print */
    }
     /* Remove gaps for print */
     #messages {
         gap: 0;
     }
     #messages .message-bubble {
         margin-bottom: var(--spacing-md);
     }
}

/* New: Global error message positioning helper */
/* This is a placeholder class. The actual positioning is done by JS */
.app-error-message {
     /* Initial styles defined above */
}
.app-error-message.show {
    /* Show styles defined above */
}

/* New: Added styles for code block copy button if you add them in HTML/JS */
/* This is outside the main app styling, specific to code blocks within descriptions */
button.copy-code-button {
    background-color: #f1f1f1;
    color: #333;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 5px 10px;
    margin-bottom: 5px;
    cursor: pointer;
    font-size: 0.9em;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    transition: background-color 0.2s ease, color 0.2s ease;
    /* Add positioning if needed, e.g., float or absolute */
    /* float: left; margin-left: 10px; */
    /* position: absolute; top: 5px; right: 5px; z-index: 1; */ /* Position on the right */
}
button.copy-code-button:hover {
    background-color: #e2e2e2;
}
button.copy-code-button i {
    color: #333;
}
button.copy-code-button.copied {
    background-color: #28a745;
    color: white;
    border-color: #28a745;
}
button.copy-code-button.copied i {
     color: white;
}
button.copy-code-button.error {
    background-color: #dc3545;
    color: white;
    border-color: #dc3545;
}
button.copy-code-button.error i {
     color: white;
}

pre {
    /* Add padding-top if using absolute positioned button inside */
    position: relative;
    /* padding-top: 30px; */
    clear: both; /* Ensure pre starts below floated button */
}
